{% load static %}
{% load widget_tweaks %}  <!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* üåô CSS Variables for Theming */
        :root {
            --body-bg: #f8f9fa; 
            --card-bg: #ffffff; 
            --text-color: #212529; 
            --primary-color: #0d6efd; 
            --border-color: rgba(0, 0, 0, 0.125);
        }

        body.dark-mode {
            --body-bg: #212529; 
            --card-bg: #2b3035; 
            --text-color: #f8f9fa; 
            --primary-color: #0d6efd; 
            --border-color: rgba(255, 255, 255, 0.125);
        }

        body {
            background-color: var(--body-bg) !important;
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }
        
        .card {
            background-color: var(--card-bg) !important;
            color: var(--text-color) !important;
            border-color: var(--border-color) !important;
        }

        .text-primary { color: var(--primary-color) !important; }
        .form-label, .card-title, .text-muted { color: var(--text-color) !important; }
        .dark-mode .text-muted { color: rgba(255, 255, 255, 0.7) !important; }

        /* General form input styling */
        .form-control, .form-control:focus {
            background-color: var(--card-bg);
            color: var(--text-color);
            border-color: var(--border-color);
        }
        .dark-mode .form-control {
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .dark-mode .invalid-feedback {
            color: #dc3545; /* Ensure error text visibility */
        }
    </style>
</head>
<body class="bg-light">
    <div class="container d-flex justify-content-center align-items-center" style="min-height: 100vh;">
        <div class="col-12 col-sm-8 col-md-6 col-lg-4">
            <div class="card shadow-lg border-0 rounded-4 p-4 p-md-5">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <legend class="card-title h3 text-primary m-0">–í—Ö–æ–¥</legend>
                    <button id="theme-toggle" class="btn btn-outline-secondary btn-sm" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-moon-fill" viewBox="0 0 16 16">
                            <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.27 7.29 7.29 7.29 1.436 0 2.8-.49 3.844-1.3A.77.77 0 0 1 15.823 15h-.498a7.21 7.21 0 0 1-9.4-4.852C5.006 8.529 6 6.55 6 5.5s-.19-2.031-.19-2.031z"/>
                        </svg>
                    </button>
                </div>
                
                {% if form.errors %}
                    <div class="alert alert-danger" role="alert">
                        –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.
                    </div>
                {% endif %}

                <form method="post">
                    {% csrf_token %}
                    
                    {% for field in form %}
                    <div class="mb-3">
                        <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                        {{ field|add_class:"form-control" }} {% for error in field.errors %}
                            <div class="invalid-feedback d-block">{{ error }}</div>
                        {% endfor %}
                    </div>
                    {% endfor %}

                    <div class="d-grid gap-2 mt-4">
                        <button class="btn btn-primary btn-lg" type="submit">–í–æ–π—Ç–∏</button>
                    </div>
                    
                    <input type="hidden" name="next" value="{{ next }}" />
                </form>
                
                <div class="border-top pt-3 mt-4 text-center">
                    <small class="text-muted">
                        –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="{% url 'users:register' %}" class="text-decoration-none fw-bold text-primary">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                    </small>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // --- Theme Toggle Logic ---
        const themeToggleBtn = document.getElementById('theme-toggle');
        const body = document.body;

        function updateThemeToggleIcon() {
            if (body.classList.contains('dark-mode')) {
                themeToggleBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-sun-fill" viewBox="0 0 16 16">
                        <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.414a.5.5 0 1 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.343 3.343a.5.5 0 0 1 .707 0l1.414 1.414a.5.5 0 0 1-.707.707L4.343 4.05a.5.5 0 0 1 0-.707z"/>
                    </svg>
                `;
            } else {
                themeToggleBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-moon-fill" viewBox="0 0 16 16">
                        <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.27 7.29 7.29 7.29 1.436 0 2.8-.49 3.844-1.3A.77.77 0 0 1 15.823 15h-.498a7.21 7.21 0 0 1-9.4-4.852C5.006 8.529 6 6.55 6 5.5s-.19-2.031-.19-2.031z"/>
                    </svg>
                `;
            }
        }
        
        function setSystemTheme() {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (prefersDark) {
                body.classList.add('dark-mode');
            } else {
                body.classList.remove('dark-mode');
            }
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                body.classList.add('dark-mode');
            } else if (savedTheme === 'light') {
                body.classList.remove('dark-mode');
            } else {
                setSystemTheme();
            }
            updateThemeToggleIcon();
        }

        function toggleTheme() {
            body.classList.toggle('dark-mode');
            const newTheme = body.classList.contains('dark-mode') ? 'dark' : 'light';
            localStorage.setItem('theme', newTheme);
            updateThemeToggleIcon();
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadTheme();
            themeToggleBtn.addEventListener('click', toggleTheme);
        });
    </script>
</body>
</html>